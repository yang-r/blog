<!-- é¡µé¢title--><!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><title>javaWeb [ Hexo ]</title><link rel="stylesheet" href="https://fonts.loli.net/css?family=Noto+Serif+SC&amp;display=swap"><link rel="stylesheet" href="/css/moods.css"><link rel="stylesheet" href="/css/archive.css"><link rel="stylesheet" href="/css/dracula.css"><meta name="generator" content="Hexo 4.2.0"></head><body><div id="contentleft"><div id="sideFence"><div class="sidebar-toc"><div class="sidebar-toc__content"><ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#ğŸ´åœ¨å‰é¢"><span class="toc-number">1.</span> <span class="toc-text">ğŸ´åœ¨å‰é¢</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#ç¯å¢ƒ"><span class="toc-number">2.</span> <span class="toc-text">ç¯å¢ƒ</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#åŸºç¡€é…ç½®"><span class="toc-number">3.</span> <span class="toc-text">åŸºç¡€é…ç½®</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#é¡µé¢"><span class="toc-number">4.</span> <span class="toc-text">é¡µé¢</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#ç™»å½•"><span class="toc-number">4.1.</span> <span class="toc-text">ç™»å½•</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#ç®¡ç†å‘˜"><span class="toc-number">4.2.</span> <span class="toc-text">ç®¡ç†å‘˜</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#å­¦ç”Ÿ"><span class="toc-number">4.3.</span> <span class="toc-text">å­¦ç”Ÿ</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#è€å¸ˆ"><span class="toc-number">4.4.</span> <span class="toc-text">è€å¸ˆ</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#æ³¨æ„äº‹é¡¹"><span class="toc-number">5.</span> <span class="toc-text">æ³¨æ„äº‹é¡¹</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#é¡µé¢è·³è½¬"><span class="toc-number">5.1.</span> <span class="toc-text">é¡µé¢è·³è½¬</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#ajaxçš„ä½¿ç”¨"><span class="toc-number">5.2.</span> <span class="toc-text">ajaxçš„ä½¿ç”¨</span></a></li></ol></li></ol></div></div><!--input(type='image' id='sideFlip' src='/images/change.png' onclick='change_btn()')--></div><button id="sideBtn">>> </button><div id="content-outer"><article class="article-detail"><h1 class="article-title">javaWeb</h1><h3 id="ğŸ´åœ¨å‰é¢"><a class="header-anchor" href="#ğŸ´åœ¨å‰é¢">Â¶</a>ğŸ´åœ¨å‰é¢</h3>
<p>ç®—æ˜¯ç¬¬ä¸€æ¬¡ä»å¤´åˆ°åº•çš„åšå®Œé¡¹ç›®å§ï¼Œè™½ç„¶æœ‰è§†é¢‘å‚è€ƒä½†æ˜¯å…¶ä¸­æœ‰å¾ˆå¤šä¸œè¥¿éƒ½æ˜¯ä¸€ç‚¹ç‚¹è¯•å‡ºæ¥çš„ï¼Œåšä¸€ä¸ªè®°å½•ï¼Œä¹Ÿç®—æ˜¯ä¸€ç§æ€»ç»“ï¼Ÿå¾ˆå¤šéƒ¨åˆ†æ˜¯ä¸ºäº†å®ç°è€Œå®ç°ï¼Œå¼ºæ‹‰ç¡¬å‡‘,ä½†è¿‡ç¨‹ç¡®å®ä¸æ˜“â€¦<br>
è€Œè·ç¦»é¡¹ç›®å®Œæˆå·²ç»è¿‡å»äº†å°†è¿‘4ä¸ªæœˆ,èƒ½æƒ³åˆ°å¤šå°‘å°±å†™å¤šå°‘å§<br>
é¡¹ç›®åç§°å°±æ˜¯è€³ç†Ÿèƒ½è¯¦çš„é€‰è¯¾ç³»ç»Ÿ,å³ä¾¿å¦‚æ­¤,èº«ä¸Šä¹Ÿæ˜¯æ»¡æ˜¯bugâ€¦</p>
<h3 id="ç¯å¢ƒ"><a class="header-anchor" href="#ç¯å¢ƒ">Â¶</a>ç¯å¢ƒ</h3>
<p>tomcat8.0,jave EE,json</p>
<h3 id="åŸºç¡€é…ç½®"><a class="header-anchor" href="#åŸºç¡€é…ç½®">Â¶</a>åŸºç¡€é…ç½®</h3>
<p>é€šè¿‡web.xmlå¯¹servletè¿›è¡Œæ˜ å°„çš„é…ç½®,</p>
<h3 id="é¡µé¢"><a class="header-anchor" href="#é¡µé¢">Â¶</a>é¡µé¢</h3>
<!-- ![é¡¹ç›®åˆ—è¡¨](javaWeb/all.png) -->
<h4 id="ç™»å½•"><a class="header-anchor" href="#ç™»å½•">Â¶</a>ç™»å½•</h4>
<p>åŸºæœ¬å°±æ˜¯ä»è¾“å…¥æ¡†è·å–å€¼,åŒæ•°æ®åº“é‡Œè¡¨çš„å€¼è¿›è¡Œé…å¯¹,ç„¶åé¡µé¢é€šè¿‡é€‰æ‹©çš„ç”¨æˆ·ç±»å‹è·³è½¬åˆ°ç›¸åº”çš„ç”¨æˆ·ç•Œé¢</p>
<pre><code class="language-java">/*
  * ç™»å½•
  */
public class Loginservlet extends HttpServlet{

	/**
	 * 
	 * 
	 */
	private static final long serialVersionUID = 1L;
	public void doGet(HttpServletRequest request,HttpServletResponse response) throws IOException {
		//request.setAttribute("flag", "word");
		doPost(request,response);
	}
	public void doPost(HttpServletRequest request,HttpServletResponse response) throws IOException {
		
		try {
			Class.forName("com.microsoft.sqlserver.jdbc.SQLServerDriver");//åŠ è½½é©±åŠ¨ ï¼ˆå…ˆå¯¼å…¥sqljdbc4.jaråˆ°WEB-INF/libä¸­ï¼Ÿ
            //ç‚¹å‡»project/properties/java build path ç‚¹å‡»add jars å¯¼å…¥å apply and close 
		} catch (ClassNotFoundException e1) {
			// TODO Auto-generated catch block
			System.out.println("é©±åŠ¨é”™è¯¯");
			e1.printStackTrace();
		}
				//é“¾æ¥æ•°æ®åº“çš„url 
				String url = "jdbc:sqlserver://localhost:1433;DatabaseName=javaWeb";//1433 ä¸ºTCPç«¯å£   DatabaseNameæ‰€éœ€è®¿é—®æ•°æ®åº“å
				//æ•°æ®åº“ç”¨æˆ·
				String user = "server01";
				//æ•°æ®åº“å¯†ç /åœ¨è¿™é‡Œè¾“å…¥æ•°æ®åº“å¯†ç 
				String password = "123";
				
				//ä»å‰å°è¯»å–åˆ°çš„ç”¨æˆ·åï¼Œå¯†ç ï¼Œç™»å½•ç±»å‹
				
				
		String user_type = request.getParameter("log_type");
		String user_id = request.getParameter("username"); // æ‹¬å·ä¸­çš„â€œusernameâ€å’Œå‰å°å±æ€§æ ‡ç­¾ä¸­çš„nameå€¼ç›¸å¯¹åº”
		// session ä¼ é€’ç”¨æˆ·å¯†ç å’Œç”¨æˆ·å
		HttpSession session = request.getSession();
		session.setAttribute("user_id", user_id);
		session.setAttribute("user_type", user_type);
		// ä»å‰å°è¯»å–åˆ°çš„å¯†ç 
		String user_pwd = request.getParameter("password");
		// System.out.println("id "+user_id+"pwd: "+user_pwd);
		// æ•°æ®åº“é“¾æ¥æˆåŠŸæ—¶è¿”å›çš„å®ä¾‹
		Connection conn = null;
		// æŸ¥è¯¢æˆåŠŸæ—¶è¿”å›çš„è®°å½•é›†
		ResultSet rs = null;
		String account_type = user_type;// æ ¹æ®ç™»å½•ç±»å‹é€‰æ‹©ç›¸åº”çš„æ•°æ®åº“:stu,teacher,manage
		try {
			// è·å–é“¾æ¥
			conn = (Connection) DriverManager.getConnection(url, user, password);
			// å‡†å¤‡sqlæŸ¥è¯¢
			String sql = "select * from " + account_type + " where id=? and key_word=?";// é—®å·ä¸ºå¾…å®šâ€œå‚æ•°å€¼â€
			// ä½¿ç”¨PreparedStatementï¼Œå¯ä»¥é˜²æ­¢sqlæ³¨å…¥
			PreparedStatement ps = conn.prepareStatement(sql);
			// å¡«å…¥â€œå‚æ•°â€å€¼
			ps.setString(1, user_id);
			ps.setString(2, user_pwd);
			// æ‰§è¡ŒæŸ¥è¯¢,è¿”å›è®°å½•é›†
			rs = ps.executeQuery();

			// æ¸¸æ ‡éå† å¦‚æœæŸ¥è¯¢åˆ°ç”¨æˆ·åå’Œå¯†ç ï¼Œåˆ™å…è®¸ç”¨æˆ·ç™»å½•
			// request.setAttribute("flag", "word");
			if (user_id.equals("") || user_pwd.equals("")) {
				PrintWriter out = response.getWriter();
				out.flush();
				out.println("&lt;script&gt;");
				out.println("alert('è¾“å…¥ä¸èƒ½ä¸ºç©º');");
				out.println("history.back();");
				out.println("&lt;/script&gt;");
				out.close();
			}
			if (rs.next()) {
				// System.out.println("login ok!!");
				// response.sendRedirect("LoginActionServlet");
				if (user_type.length() &gt; 0) {
					sendMsg(user_type, request, response);
				} else if (user_type == null) {
					PrintWriter out = response.getWriter();
					out.flush();
					out.println("&lt;script&gt;");
					out.println("alert('è¯·é€‰æ‹©ç™»å½•ç±»å‹');");
					out.println("&lt;/script&gt;");
					out.close();
				}
				// response.sendRedirect("manage.jsp");
				// request.getRequestDispatcher("manage.jsp").forward(request, response);
			} else {
				PrintWriter out = response.getWriter();

				out.flush();
				out.println("&lt;script&gt;");
				out.println("alert('å¾ˆé—æ†¾ï¼Œç”¨æˆ·åæˆ–å¯†ç é”™è¯¯');");
				out.println("history.back();");
				out.println("&lt;/script&gt;");
				out.close();
			}
			// å…³é—­PreparedStatement
			ps.close();
					
				}catch(Exception e){
					e.printStackTrace();
				}finally{
					//æœ€åä¸€å®šè¦å…³é—­é“¾æ¥
					if (conn != null){
						try {
							conn.close();
						} catch (SQLException e) {
							// TODO Auto-generated catch block
							e.printStackTrace();
						}
					}
					if(rs != null){
						try {
							rs.close();
						} catch (SQLException e) {
							// TODO Auto-generated catch block
							e.printStackTrace();
						}
					}
					
				}
				return;
			}
	private void sendMsg(String user_type,HttpServletRequest request, HttpServletResponse response) throws IOException, Exception {
		
		//request.getRequestDispatcher("Loginservlet").forward(request, response);
		//String selected=request.getParameter("info_select");
		//response.setContentType("application/json;character=utf-8");
		response.setContentType("charset=utf-8");

		//PrintWriter out =response.getWriter();
		PrintWriter out=response.getWriter();
		out.print(user_type);
		out.close();
		
		//request.setAttribute("stuList", list);
	}
	
}

</code></pre>
<h4 id="ç®¡ç†å‘˜"><a class="header-anchor" href="#ç®¡ç†å‘˜">Â¶</a>ç®¡ç†å‘˜</h4>
<p>å°±é€‰ä¸€ä¸ªå¯¹å­¦ç”Ÿç”¨æˆ·çš„ç®¡ç†æ¥</p>
<pre><code class="language-java">/**
 * Servlet implementation class Systemservlet
 */
@WebServlet("/Systemservlet")
public class Manservlet extends HttpServlet {
	private static final long serialVersionUID = 1L;
       
	/**
	 * @see HttpServlet#doGet(HttpServletRequest request, HttpServletResponse response)
	 */
	protected void doGet(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException {
		// TODO Auto-generated method stub
		doPost(request,response);
	}
//
	/**
	 * @see HttpServlet#doPost(HttpServletRequest request, HttpServletResponse response)
	 */
	protected void doPost(HttpServletRequest req, HttpServletResponse rep) throws ServletException, IOException {
		// TODO Auto-generated method stub
		//req.getRequestDispatcher("manage.jsp").forward(req, rep);  jsp2jspè·³è½¬é¡µé¢ï¼Œä¸èƒ½åœ¨servletè·³è½¬
		rep.setCharacterEncoding("UTF-8");
		rep.setContentType("application/json;charset=utf-8"  );
		req.setCharacterEncoding("utf-8");
		String method = req.getParameter("method");	
		String type=req.getParameter("type");
		//System.out.print(method);
		
		 if("stu".equals(method)) {
				stu_info(req,rep,type);
		}
    }

    private void stu_info(HttpServletRequest req,HttpServletResponse rep,String type) throws IOException {
		PrintWriter send=rep.getWriter();
		if(type.equals("select")) {
			find_stu(send);
		}
		else if(type.equals("up")) {
		
			 String sql = man_up_stu(req);
			 doing_sql(send,sql);
		}
		else if(type.equals("del")) {
			String sno=req.getParameter("sno");
			System.out.println(sno);
			String sql="delete from Student where Sno="+sno;
			doing_sql(send,sql);
		}
		else if(type.equals("add")) {

			String sql = man_add_stu(req);

			System.out.println(sql);
			doing_sql(send,sql);
		}
		//
	}
</code></pre>
<h4 id="å­¦ç”Ÿ"><a class="header-anchor" href="#å­¦ç”Ÿ">Â¶</a>å­¦ç”Ÿ</h4>
<h4 id="è€å¸ˆ"><a class="header-anchor" href="#è€å¸ˆ">Â¶</a>è€å¸ˆ</h4>
<h3 id="æ³¨æ„äº‹é¡¹"><a class="header-anchor" href="#æ³¨æ„äº‹é¡¹">Â¶</a>æ³¨æ„äº‹é¡¹</h3>
<h4 id="é¡µé¢è·³è½¬"><a class="header-anchor" href="#é¡µé¢è·³è½¬">Â¶</a>é¡µé¢è·³è½¬</h4>
<h4 id="ajaxçš„ä½¿ç”¨"><a class="header-anchor" href="#ajaxçš„ä½¿ç”¨">Â¶</a>ajaxçš„ä½¿ç”¨</h4>
<script>
        document.querySelectorAll('.github-emoji')
          .forEach(el => {
            if (!el.dataset.src) { return; }
            const img = document.createElement('img');
            img.style = 'display:none !important;';
            img.src = el.dataset.src;
            img.addEventListener('error', () => {
              img.remove();
              el.style.color = 'inherit';
              el.style.backgroundImage = 'none';
              el.style.background = 'none';
            });
            img.addEventListener('load', () => {
              img.remove();
            });
            document.body.appendChild(img);
          });
      </script></article><div id="paginator"></div><!--å¦‚æœæ˜¯æ–‡ç« é¡µé¢--><!-- - ç»™tocä¼ å…¥å½“å‰é¡µé¢çš„å†…å®¹ç”¨äºç”Ÿæˆç›®å½•ç»“æ„#paginator!= paginator()--></div><div id="bottom-outer"><div id="bottom-inner"><span>Site construction by</span><span> John Doe </span><span>using</span><a href="http://hexo.io" target="_blank" rel="noopener"><span>hexo blog framework</span></a><span>.</span><br><a href="/">Home</a></div></div><script src="/js/jquery.js"></script><script src="/js/moods.js"></script><script src="/js/highlight.pack.js"></script><script src="/js/page.js"></script><script>hljs.initHighlightingOnLoad(); //å¼•ç”¨highlight.jsååˆå§‹åŒ–</script><!--éŸ³ä¹æ’­æ”¾å™¨--><!--include ./aplayer.pug    --></div><script>$(document).pjax('a[target!=_blank]', '#contentleft', {fragment:'#contentleft', timeout:8000}); </script></body></html>